import std.*;

// FFI STRUCTURES DECLARATION
FFIStruct.addStruct("ExtS");

FFIStruct.addMember("ExtS", "l1", FFITypes.DOUBLE);
FFIStruct.addMember("ExtS", "l2", FFITypes.INT);
FFIStruct.addMember("ExtS", "l3", FFITypes.INT);
FFIStruct.addMember("ExtS", "l4", FFITypes.DOUBLE);


FFIStruct.addMember("ExtS", "y", FFITypes.DOUBLE);
FFIStruct.addMember("ExtS", "x", FFITypes.INT);
FFIStruct.addMember("ExtS", "z", FFITypes.INT);
FFIStruct.addMember("ExtS", "w", FFITypes.DOUBLE);

// FFI STRUCTURE CREATION
var s = FFIStruct.new("ExtS");


s.setMember("x", 1);
s.setMember("y", 3.123);
s.setMember("z", 2);
s.setMember("w", 902.1231375);

println(s.x);
println(s.y);
println(s.z);
println(s.w);

var h =  FFILib.new("nffi");

// FFI CALL

h.call("setC", FFITypes.VOID, s, 1111, 33.323123, 22, 283.123);

var x = h.call("getCX", FFITypes.INT, s);
var y = h.call("getCY", FFITypes.DOUBLE, s);
var z = h.call("getCZ", FFITypes.INT, s);
var w = h.call("getCW", FFITypes.DOUBLE, s);


printf("===================\n");
println(x, y, z, w);

printf("===================\n");
println(s.x);
println(s.y);
println(s.z);
println(s.w);
println(s.w);


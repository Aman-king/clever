import std.*;

// FFI STRUCTURES DECLARATION
FFIStruct.addStruct("ExtS");

FFIStruct.addMember("ExtS", "l1", "d");
FFIStruct.addMember("ExtS", "l2", "i");
FFIStruct.addMember("ExtS", "l3", "i");
FFIStruct.addMember("ExtS", "l4", "d");


FFIStruct.addMember("ExtS", "y", "d");
FFIStruct.addMember("ExtS", "x", "i");
FFIStruct.addMember("ExtS", "z", "i");
FFIStruct.addMember("ExtS", "w", "d");

// FFI STRUCTURE CREATION
var s = FFIStruct.new("ExtS");


s.setMember("x", 1);
s.setMember("y", 3.123);
s.setMember("z", 2);
s.setMember("w", 902.1231375);

println(s.getMember("x"));
println(s.getMember("y"));
println(s.getMember("z"));
println(s.getMember("w"));

var h =  FFILib.new("nffi");

// FFI CALL

//h.call("setC", "v", s, 1111, 33.323123, 22, 283.123);

var x = h.call("getCX", "i", s);
var y = h.call("getCY", "d", s);
var z = h.call("getCZ", "i", s);
var w = h.call("getCW", "d", s);


printf("===================\n");
println(x, y, z, w);

printf("===================\n");
println(s.getMember("x"));
println(s.getMember("y"));
println(s.getMember("z"));
println(s.getMember("w"));

